<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…ØªØ¬Ø± Ø­Ø¯ÙŠØ«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  direction:rtl;
  margin:0;
  padding:0;
  background:#f4f4f4;
}

.section{display:none;padding:20px;}

button{
  cursor:pointer;
  border:none;
  padding:8px 12px;
  margin:5px;
  background:#dcdcdc;
  border-radius:6px;
  font-weight:bold;
}

input,select{
  margin:5px;
  padding:5px;
  border-radius:5px;
  border:1px solid #ccc;
}

.product-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.product-card{
  background:#fff;
  padding:8px;
  border-radius:8px;
  text-align:center;
  font-size:14px;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
}

.product-img{
  width:80px;
  height:80px;
  object-fit:cover;
  margin:auto;
  display:block;
}

.product-card button{
  background:#28a745;
  color:white;
}

@media(max-width:768px){
  .product-grid{
    grid-template-columns:repeat(2,1fr);
  }
}
</style>
</head>
<body>

<div id="home" class="section">
<h2>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2>
<button onclick="showSection('ownerLogin')">ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</button>
<button onclick="showSection('customer')">Ø§Ù„Ù…Ø´ØªØ±ÙŠ</button>
</div>

<div id="ownerLogin" class="section">
<h2>Ø¯Ø®ÙˆÙ„ ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
<input type="password" id="ownerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
<button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="owner" class="section">
<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

<input type="text" id="storeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±"><br>
<input type="text" id="buyerPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù…ØµØ±ÙŠ 011xxxxxxxx"><br>

<h3>Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ</h3>
<input type="text" id="categoryName">
<button onclick="addCategory()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="categoryList"></div>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
<select id="categorySelect"></select><br>
<input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input type="number" id="productPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input type="file" id="productImgFile"><br>
<img id="productPreview" style="width:80px"><br>
<button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>

<br><br>
<button onclick="saveData()">Ø­ÙØ¸</button>
<button onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="customer" class="section">
<h2 id="custStoreName"></h2>

<h3>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h3>
<div id="custCategoryList"></div>

<h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
<div class="product-grid" id="custProductList"></div>

<h3>Ø§Ù„Ø³Ù„Ø©</h3>
<div id="cartList"></div>
<button onclick="checkout()" style="background:#007bff;color:white">
Ø¥ØµØ¯Ø§Ø± ÙØ§ØªÙˆØ±Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙˆØ§ØªØ³Ø§Ø¨
</button>
</div>

<script>
const OWNER_PASSWORD="12345";

let store=JSON.parse(localStorage.getItem('store'))||{
  name:"Ù…ØªØ¬Ø±ÙŠ",
  categories:[],
  buyerPhone:""
};

let cart=[];

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  if(id==='owner')loadOwner();
  if(id==='customer')loadCustomer();
}

function checkPassword(){
  if(document.getElementById('ownerPassword').value===OWNER_PASSWORD){
    showSection('owner');
  }else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£");
}

function saveData(){
  const phone=document.getElementById('buyerPhone').value.trim();
  const pattern=/^(010|011|012|015)\d{8}$/;

  if(!pattern.test(phone)){
    alert("Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­");
    return;
  }

  store.name=document.getElementById('storeName').value;
  store.buyerPhone=phone;
  localStorage.setItem('store',JSON.stringify(store));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}

function loadOwner(){
  document.getElementById('storeName').value=store.name;
  document.getElementById('buyerPhone').value=store.buyerPhone;
  updateCategories();
}

function addCategory(){
  const name=document.getElementById('categoryName').value.trim();
  if(!name)return;
  store.categories.push({name:name,products:[]});
  localStorage.setItem('store',JSON.stringify(store));
  updateCategories();
}

function updateCategories(){
  const list=document.getElementById('categoryList');
  const sel=document.getElementById('categorySelect');
  list.innerHTML="";
  sel.innerHTML="";
  store.categories.forEach((c,i)=>{
    list.innerHTML+=c.name+"<br>";
    sel.innerHTML+=`<option value="${i}">${c.name}</option>`;
  });
}

document.getElementById('productImgFile').addEventListener('change',e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=ev=>{
    document.getElementById('productPreview').src=ev.target.result;
    document.getElementById('productPreview').dataset.src=ev.target.result;
  };
  reader.readAsDataURL(file);
});

function addProduct(){
  const idx=document.getElementById('categorySelect').value;
  const name=document.getElementById('productName').value.trim();
  const price=document.getElementById('productPrice').value;
  const img=document.getElementById('productPreview').dataset.src;

  if(!name||!price||!img)return alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  store.categories[idx].products.push({
    name:name,
    price:parseFloat(price),
    img:img
  });

  localStorage.setItem('store',JSON.stringify(store));
  alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
}

function loadCustomer(){
  document.getElementById('custStoreName').innerText=store.name;
  updateCustomerCategories();
  updateCart();
}

function updateCustomerCategories(){
  const div=document.getElementById('custCategoryList');
  div.innerHTML="";
  store.categories.forEach((c,i)=>{
    const btn=document.createElement('button');
    btn.textContent=c.name;
    btn.onclick=()=>showProducts(i);
    div.appendChild(btn);
  });
}

function showProducts(idx){
  const div=document.getElementById('custProductList');
  div.innerHTML="";
  store.categories[idx].products.forEach((p,i)=>{
    div.innerHTML+=`
      <div class="product-card">
        <img src="${p.img}" class="product-img">
        <b>${p.name}</b><br>
        ${p.price} Ø±ÙŠØ§Ù„<br>
        <button onclick="addToCart(${idx},${i})">Ø£Ø¶Ù</button>
      </div>
    `;
  });
}

function addToCart(c,p){
  let item=cart.find(x=>x.c===c&&x.p===p);
  if(item)item.qty++;
  else cart.push({...store.categories[c].products[p],c:c,p:p,qty:1});
  updateCart();
}

function updateCart(){
  const div=document.getElementById('cartList');
  div.innerHTML="";
  let total=0;
  cart.forEach(i=>{
    total+=i.price*i.qty;
    div.innerHTML+=`${i.name} Ã— ${i.qty}<br>`;
  });
  div.innerHTML+="<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total+" Ø±ÙŠØ§Ù„</b>";
}

function checkout(){
  if(cart.length===0)return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");

  const invoiceId="INV"+Date.now();
  const total=cart.reduce((s,p)=>s+p.price*p.qty,0);

  let itemsText="";
  cart.forEach(item=>{
    itemsText+=`${item.name} Ã— ${item.qty} = ${item.price*item.qty} Ø±ÙŠØ§Ù„\n`;
  });

  const cleanPhone="20"+store.buyerPhone.substring(1);

  const message=
`ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
-----------------------
Ø§Ù„Ù…ØªØ¬Ø±: ${store.name}
Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoiceId}
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString()}
-----------------------
${itemsText}
-----------------------
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„`;

  const url=`https://api.whatsapp.com/send?phone=${cleanPhone}&text=${encodeURIComponent(message)}`;

  window.location.href=url;

  cart=[];
  updateCart();
}

window.onload=()=>showSection('home');
</script>
</body>
</html>
